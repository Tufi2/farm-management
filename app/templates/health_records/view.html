{% extends "base.html" %}

{% block title %}Health Record Details{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h2 class="h5 mb-0">Health Record Details</h2>
                    <div>
                        <a href="{{ url_for('health_records.edit', id=record.id) }}" class="btn btn-light btn-sm me-2">
                            <i class="fas fa-edit me-1"></i>Edit
                        </a>
                        <button onclick="confirmDelete({{ record.id }}, '{{ record.animal.tag_number }}')" 
                                class="btn btn-danger btn-sm">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Basic Information -->
                    <div class="row mb-4">
                        <h3 class="h6 text-muted mb-3">Basic Information</h3>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Tag Number:</strong> {{ record.animal.tag_number }}</p>
                            <p class="mb-2"><strong>Animal Name:</strong> {{ record.animal.name or 'N/A' }}</p>
                            <p class="mb-2"><strong>Species:</strong> {{ record.animal.species }}</p>
                            <p class="mb-2"><strong>Breed:</strong> {{ record.animal.breed or 'N/A' }}</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Record Date:</strong> {{ record.date.strftime('%Y-%m-%d') }}</p>
                            <p class="mb-2"><strong>Record Type:</strong> {{ record.record_type }}</p>
                            <p class="mb-2"><strong>Created By:</strong> {{ record.created_by.name }}</p>
                            <p class="mb-2"><strong>Created At:</strong> {{ record.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>
                    </div>

                    <!-- Health Status -->
                    <div class="row mb-4">
                        <h3 class="h6 text-muted mb-3">Health Status</h3>
                        <div class="col-12">
                            {% set description = record.description|from_json %}
                            <p class="mb-2"><strong>Current Health:</strong> 
                                {{ description.get('Health Status', {}).get('Current', 'N/A') }}</p>
                            <p class="mb-2"><strong>Vaccination Status:</strong>
                                {{ description.get('Health Status', {}).get('Vaccination', 'N/A') }}</p>
                        </div>
                    </div>

                    <!-- Wool Quality -->
                    <div class="row mb-4">
                        <h3 class="h6 text-muted mb-3">Wool Quality</h3>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Condition:</strong>
                                {{ description.get('Wool Quality', {}).get('Condition', 'N/A') }}</p>
                            <p class="mb-2"><strong>Texture:</strong>
                                {{ description.get('Wool Quality', {}).get('Texture', 'N/A') }}</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Last Shearing:</strong>
                                {{ description.get('Wool Quality', {}).get('Last Shearing', 'N/A') }}</p>
                            <p class="mb-2"><strong>Next Shearing:</strong>
                                {{ description.get('Wool Quality', {}).get('Next Shearing', 'N/A') }}</p>
                        </div>
                    </div>

                    <!-- Lambing History -->
                    <div class="row mb-4">
                        <h3 class="h6 text-muted mb-3">Lambing History</h3>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Status:</strong>
                                {{ description.get('Lambing', {}).get('Status', 'N/A') }}</p>
                            <p class="mb-2"><strong>Due Date:</strong>
                                {{ description.get('Lambing', {}).get('Due Date', 'N/A') }}</p>
                            <p class="mb-2"><strong>Number of Lambs:</strong>
                                {{ description.get('Lambing', {}).get('Number of Lambs', 'N/A') }}</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>Lambing Ease:</strong>
                                {{ description.get('Lambing', {}).get('Lambing Ease', 'N/A') }}</p>
                            <p class="mb-2"><strong>Notes:</strong>
                                {{ description.get('Lambing', {}).get('Notes', 'N/A') }}</p>
                        </div>
                    </div>

                    <!-- Treatment Details -->
                    {% if record.treatment %}
                    <div class="row mb-4">
                        <h3 class="h6 text-muted mb-3">Treatment Details</h3>
                        <div class="col-12">
                            <p class="mb-2">{{ record.treatment }}</p>
                        </div>
                    </div>
                    {% endif %}

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <a href="{{ url_for('health_records.index') }}" class="btn btn-secondary">Back to List</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this health record for animal with tag number 
                <span id="deleteTagNumber" class="fw-bold"></span>?
                <p class="text-danger mt-2 mb-0"><small>This action cannot be undone.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="POST" action="">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        margin-bottom: 2rem;
    }
    .card-header {
        padding: 1rem;
    }
    .h6 {
        color: #6c757d;
        font-weight: 600;
    }
    .mb-4 {
        border-bottom: 1px solid #eee;
        padding-bottom: 1.5rem;
    }
    .mb-4:last-child {
        border-bottom: none;
    }
    strong {
        color: #495057;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
function confirmDelete(recordId, tagNumber) {
    document.getElementById('deleteTagNumber').textContent = tagNumber;
    document.getElementById('deleteForm').action = "{{ url_for('health_records.delete', id=0) }}".replace('0', recordId);
    new bootstrap.Modal(document.getElementById('deleteModal')).show();
}
</script>
{% endblock %}